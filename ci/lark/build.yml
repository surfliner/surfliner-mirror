lark-ruby-build:
  image: $CI_REGISTRY_IMAGE/buildah
  stage: build
  script:
    - buildah login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" "$CI_REGISTRY"
    - cd lark
    - buildah bud --format docker --storage-driver vfs -t $CI_REGISTRY_IMAGE/lark_web:$CI_COMMIT_REF_NAME .
    - buildah push --storage-driver vfs docker://$CI_REGISTRY_IMAGE/lark_web:$CI_COMMIT_REF_NAME
  extends: .only-refs-default
  only:
    changes:
      - .gitlab-ci.yml
      - ci/lark/**/*
      - lark/Dockerfile
      - lark/**/*

lark-frontend-node-build:
  image: $CI_REGISTRY_IMAGE/buildah
  stage: build
  script:
    - buildah login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" "$CI_REGISTRY"
    - cd lark-frontend
    - buildah bud --format docker --storage-driver vfs -t $CI_REGISTRY_IMAGE/lark_frontend_web:latest .
    - buildah push --storage-driver vfs docker://$CI_REGISTRY_IMAGE/lark_frontend_web:latest
  extends: .only-refs-default
  only:
    changes:
      - .gitlab-ci.yml
      - lark/Dockerfile
      - ci/lark/**/*
      - lark-frontend/**/*
