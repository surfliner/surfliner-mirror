include:
  - local: ci/lark/build.yml
  - local: ci/lark/lint.yml
  - local: ci/lark/test.yml
  - local: ci/lark/review.yml
  - local: ci/lark/staging.yml
  - local: ci/lark/production.yml

.deploy-lark:
  extends:
    - .helm3-deploy
    - .only-lark-changes
  needs: ["lark:ruby-build", "lark:frontend:node-build"]
  artifacts:
    paths: [environment_url.txt]

.only-lark-changes:
  only:
    changes:
      - .gitlab-ci.yml
      - ci/lark.yml
      - ci/lark/**/*
      - charts/lark/**/*
      - gems/**/*
      - lark/**/*
      - lark-client/**/*
      - lark-frontend/**/*

.only-lark-api-changes:
  only:
    changes:
      - .gitlab-ci.yml
      - ci/lark.yml
      - ci/lark/**/*
      - charts/lark/**/*
      - lark/**/*

.only-lark-cli-changes:
  only:
    changes:
      - .gitlab-ci.yml
      - ci/lark.yml
      - ci/lark/**/*
      - charts/lark/**/*
      - lark-client/**/*

.only-lark-frontend-changes:
  only:
    changes:
      - .gitlab-ci.yml
      - ci/lark.yml
      - ci/lark/**/*
      - charts/lark/**/*
      - lark-frontend/**/*
