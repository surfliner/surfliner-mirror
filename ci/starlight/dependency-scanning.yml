starlight-dependency-scanning:
  stage: test
  image: docker:$DOCKER_IMAGE_VERSION
  services:
    - docker:$DOCKER_IMAGE_VERSION-dind
  script:
    - setup_docker
    - apk --no-cache upgrade && apk add --no-cache yarn
    - cd starlight
    - yarn install
    - dependency_scanning
  artifacts:
    reports:
      dependency_scanning: starlight/gl-dependency-scanning-report.json
  extends: .only-refs-default
  only:
    changes:
      - starlight/**/*
    variables:
      - $GITLAB_FEATURES =~ /\bdependency_scanning\b/
  except:
    variables:
      - $DEPENDENCY_SCANNING_DISABLED
