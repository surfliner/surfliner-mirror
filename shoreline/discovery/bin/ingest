#!/usr/bin/env ruby
# frozen_string_literal: true

$stdout.sync = true # flush output immediately

puts 'Loading environment...'
require File.expand_path('../config/environment', __dir__)
puts "Running in #{Rails.env} mode..."

# If there are no options given, invoke help
ARGV << '-h' if ARGV.empty?

options = Optimist.options do
  banner <<~EOS
    Command line object ingest for Shoreline

    Example:
          RAILS_ENV=development ./bin/ingest -f path/to/shapefile
    Usage:
          RAILS_ENV=[development|test|production] ./bin/ingest [options]
    where [options] are:

  EOS
  opt :file, 'Shapefile', type: :string
  opt :verbosity,
      'Log verbosity: DEBUG, INFO, WARN, ERROR',
      type: :string,
      default: 'INFO',
      short: '-v'
end

Importer.run(options.merge(logfile: $stdout))
