---
- name: Provision a RHEL/CentOS server with Shibboleth SP
  hosts: all
  environment:
    - http_proxy: "{{ proxy | default('') }}"
    - https_proxy: "{{ proxy | default('') }}"
    - no_proxy: "localhost,127.0.0.0"

  vars:
    deploy_user: "{{ ansible_user_id }}"
    deploy_group: "{{ ansible_user_id }}"
    project_name: starlight

  roles:
    - role: apache
    - role: cmprescott.xml
    - role: cscfi.shibboleth-sp
      vars:
        shibbolethsp_saml_crt: sp-encrypt-cert.pem
        shibbolethsp_saml_key: sp-encrypt-key.pem
        shibbolethsp_handlerssl: false
        shibbolethsp_cookieprops: http
        configurables:
          - certs
      become: true
    - role: shibboleth-metadata
