---
- name: install Redis
  yum:
    name: redis
    update_cache: true
  become: yes

- name: install systemd script for Sidekiq
  template:
    dest: /etc/systemd/system/sidekiq.service
    src: sidekiq.service.j2
  become: yes

- name: start Redis
  systemd:
    daemon_reload: true
    enabled: yes
    name: redis
    state: restarted
  become: yes

- name: enable Sidekiq
  systemd:
    enabled: yes
    name: sidekiq
  become: yes

- name: allow Capistrano to restart Sidekiq
  template:
    src: sudoers-sidekiq.j2
    dest: /etc/sudoers.d/sidekiq
    mode: 0440
    validate: visudo -c -f %s
