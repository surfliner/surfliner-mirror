---
- name: add shared directories, ensure ownership
  file:
    path: "{{ item }}"
    owner: "{{ deploy_user }}"
    group: "{{ deploy_group }}"
    state: directory
  with_items:
    - "{{ project_base }}/{{ project_name }}"
    - "{{ config_path }}/environments"
    - "{{ config_path }}/log"
    - "{{ project_base }}/{{ project_name }}/shared/log"
    - /var/log/spotlight

- name: add logrotate configuration
  template:
    src: rails-logs.conf.j2
    dest: /etc/logrotate.d/rails-logs.conf

- name: install vhost configuration
  template:
    src: vhost.conf.j2
    dest: /etc/httpd/conf.d/{{ project_name }}.conf
  become: yes

- name: restart httpd
  systemd:
    name: httpd
    state: restarted
  become: yes
