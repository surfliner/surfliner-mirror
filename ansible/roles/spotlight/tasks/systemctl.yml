---
- name: install systemd script for Sidekiq
  template:
    dest: /etc/systemd/system/sidekiq.service
    src: sidekiq.service.j2
  become: yes

- name: write systemctl variables file
  template:
    src: systemctl-vars.j2
    dest: /home/{{ deploy_user }}/.systemctl-variables

- name: enable Sidekiq
  systemd:
    daemon_reload: true
    enabled: yes
    name: sidekiq
  become: yes

- name: allow Capistrano to restart Sidekiq
  template:
    src: sudoers-sidekiq.j2
    dest: /etc/sudoers.d/sidekiq
    mode: 0440
    validate: visudo -c -f %s
