---
- name: Have we bypassed passenger for Shibboleth.sso?
  find:
    paths: /etc/httpd/conf.d
    pattern: shib.conf
    contains: 'PassengerEnabled off'
  register: shib_conf

- name: Bypass passenger for Shibboleth.sso
  lineinfile:
    dest: /etc/httpd/conf.d/shib.conf
    line: '  PassengerEnabled off'
    insertafter: '^<Location /Shibboleth.sso>'
    state: present
  when: shib_conf.matched == 0
