---
- name: generate key base
  shell: openssl rand -base64 64 | sha256sum | tr -d '\n\ -'
  register: rando

- name: set rails secret key base
  set_fact:
    rails_secret_key_base: "{{ rando.stdout }}"

- name: write environment variables file
  template:
    src: vars.sh.j2
    dest: /home/{{ deploy_user }}/.{{ project_name }}

- name: source environment variables file
  lineinfile:
    backup: yes
    line: "source /home/{{ deploy_user }}/.{{ project_name }}"
    path: /home/{{ deploy_user }}/.bashrc
