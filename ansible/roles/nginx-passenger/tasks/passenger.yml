---
- name: install Ruby dependencies
  command: "{{ ruby_bin_root }}/gem install --no-document {{ item }}"
  with_items:
    - bundler
    - rack
    - passenger
  become: yes

- name: install passenger-install-nginx-module
  command: "{{ ruby_bin_root }}/passenger-install-nginx-module --auto"
  args:
    creates: /opt/nginx/conf/nginx.conf
  become: yes

- name: install systemd script for Nginx
  copy:
    dest: /etc/systemd/system/nginx.service
    src: nginx.service
  become: yes

- name: restart Nginx
  systemd:
    daemon_reload: true
    enabled: yes
    name: nginx
    state: restarted
  become: yes
