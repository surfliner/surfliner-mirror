---
- name: Provision a RHEL/CentOS server for Spotlight
  remote_user: adrl
  hosts: all

  vars_files:
    - vault/spotlight.yml

  vars:
    # deploy_user: adrl
    # deploy_group: adrl

    ruby_bin_root: /usr/local/rbenv/shims
    ruby_ver: 2.5.3
    rbenv:
      env: system
      # required
      version: v1.1.1
      default_ruby: "{{ ruby_ver }}"
      rubies:
        - version: "{{ ruby_ver }}"

    solr_host: localhost
    smtp_host:

    db_host: localhost
    db_name: spotlight_db
    # set in vault file
    # db_pass:
    db_user: spotlight

    postgresql_databases:
      - name: "{{ db_name }}"
    postgresql_users:
      - name: "{{ db_user }}"
        db: "{{ db_name }}"
        password: "{{ db_pass }}"

  roles:
    - role: geerlingguy.postgresql
      become: yes
    - role: solr
      become: yes
    - role: zzet.rbenv
      rbenv_owner: root
      rbenv_group: root
    - role: nginx-passenger
      become: yes
    - role: spotlight
      become: yes
